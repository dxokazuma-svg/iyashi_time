<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ç™’ã—å¾…å¤¢ çµ¦æ–™è¨ˆç®—ï¼ˆæŒ‡ååˆ¥ãƒãƒƒã‚¯ï¼‰</title>

<style>
:root{
  --pink:#F6A5C0;
  --pink-soft:#FDE7EF;
  --pink-strong:#E85A8A;
  --border:#F6A5C0;
  --muted:#666;
}
body{font-family:-apple-system,BlinkMacSystemFont,"Noto Sans JP",sans-serif;background:#fff;margin:0;}
header{background:var(--pink);color:#fff;text-align:center;padding:14px;font-weight:800;}
.container{padding:14px;max-width:560px;margin:0 auto;}
.card{background:var(--pink-soft);border-radius:14px;padding:14px;margin-bottom:12px;}
h3{margin:0 0 10px;font-size:16px;}
select{width:100%;padding:12px;font-size:18px;border-radius:12px;border:2px solid var(--border);font-weight:800;}
.btn-row{display:flex;flex-wrap:wrap;gap:10px;}
.btn{flex:1 1 30%;padding:14px 10px;border-radius:12px;border:2px solid var(--border);background:#fff;color:var(--pink);font-weight:800;font-size:14px;}
.btn.active{background:var(--pink);color:#fff;}
.result{text-align:center;}
.label{color:var(--muted);font-size:14px;}
.value{font-size:34px;color:var(--pink-strong);font-weight:900;}
.value.small{font-size:30px;}
.primary{width:100%;border:none;border-radius:14px;padding:14px;font-size:17px;font-weight:900;background:var(--pink);color:#fff;}
.list{background:#fff;border-radius:14px;padding:10px;border:2px solid #f3b7cc;}
.row{display:grid;grid-template-columns:1.3fr 1fr 1fr 1fr auto;gap:6px;padding:6px;font-size:13px;border-bottom:1px solid #eee;}
.row.head{font-weight:900;color:#666;}
.cell.back{color:var(--pink-strong);font-weight:900;}
.sticky{background:var(--pink-soft);border:2px solid #f3b7cc;border-radius:14px;padding:10px;margin-top:10px;font-weight:900;}
.note{color:#666;font-size:12px;margin-top:6px;}
</style>
</head>

<body>
<header>
ç™’ã—å¾…å¤¢<br>
<small>çµ¦æ–™è¨ˆç®—</small>
</header>

<div class="container">

<!-- ãŠå®¢ã•ã‚“é‡‘é¡ -->
<div class="card">
  <h3>ãŠå®¢ã•ã‚“é‡‘é¡</h3>
  <select id="price">
    <option value="0">é¸æŠã—ã¦ãã ã•ã„</option>
  </select>
  <div class="note">â€» ã‚«ãƒ¼ãƒ‰æ±ºæ¸ˆã¯0å††æ‰±ã„</div>
</div>

<!-- ã‚³ãƒ¼ã‚¹ -->
<div class="card">
  <h3>ã‚³ãƒ¼ã‚¹ï¼ˆå¿…ãš1ã¤ï¼‰</h3>
  <div class="btn-row">
    <button class="btn course-btn" data-course="90">90åˆ†</button>
    <button class="btn course-btn" data-course="120">120åˆ†</button>
    <button class="btn course-btn" data-course="150">150åˆ†</button>
  </div>
</div>

<!-- æŒ‡å -->
<div class="card">
  <h3>æŒ‡åï¼ˆã©ã‚Œã‹1ã¤ï¼‰</h3>
  <div class="btn-row">
    <button class="btn nom-btn" data-nom="free">ãƒ•ãƒªãƒ¼</button>
    <button class="btn nom-btn" data-nom="net">ãƒãƒƒãƒˆæŒ‡å</button>
    <button class="btn nom-btn" data-nom="hon">æœ¬æŒ‡å</button>
  </div>
</div>

<!-- å»¶é•· -->
<div class="card">
  <h3>å»¶é•·ï¼ˆã©ã‚Œã‹1ã¤ï¼‰</h3>
  <div class="btn-row">
  <button class="btn ext-btn" data-ext="none">ãªã—</button>
  <button class="btn ext-btn" data-ext="30">+30åˆ†</button>
  <button class="btn ext-btn" data-ext="60">+60åˆ†</button>
  <button class="btn ext-btn" data-ext="90">+90åˆ†</button>
  <button class="btn ext-btn" data-ext="120">+120åˆ†</button>
  <button class="btn ext-btn" data-ext="150">+150åˆ†</button>
</div>
</div>

<!-- çµæœ -->
<div class="card result">
  <div class="label">ä»Šå›ã®ãƒãƒƒã‚¯åˆè¨ˆ</div>
  <div class="value" id="back">Â¥ 0</div>
  <div style="height:10px;"></div>
  <div class="label">ä»Šå›ã®åº—è½ã¡</div>
  <div class="value small" id="shop">Â¥ 0</div>
</div>

<button class="primary" id="addBtn">ã“ã®å†…å®¹ã‚’è¿½åŠ </button>

<!-- å±¥æ­´ -->
<div class="card">
  <h3>ä»Šæ—¥ã®å±¥æ­´</h3>
  <div class="list" id="listArea"></div>
  <div class="sticky" id="totalArea"></div>
</div>

</div>

<script>
// ===== ãƒãƒƒã‚¯è¡¨ï¼ˆã‚³ãƒ¼ã‚¹Ã—æŒ‡åï¼‰=====
const COURSE_BACK = {
  "90":  { free: 6500, net: 7000, hon: 8800 },
  "120": { free: 8000, net: 8500, hon: 10600 },
  "150": { free: 10000, net: 10500, hon: 13000 },
};

// ===== ãƒãƒƒã‚¯è¡¨ï¼ˆå»¶é•·Ã—æŒ‡åï¼‰=====
// â€»ãƒãƒƒãƒˆæŒ‡åã¯ãƒ•ãƒªãƒ¼æ‰±ã„ï¼ˆä»•æ§˜ï¼‰
// 30åˆ†ï¼šãƒ•ãƒªãƒ¼2500 / æœ¬æŒ‡å3000
// 60åˆ†ï¼šãƒ•ãƒªãƒ¼5000 / æœ¬æŒ‡å6000
const EXT_BACK = {
  "none": { free: 0, hon: 0 },

  "30":   { free: 2500,  hon: 3000 },
  "60":   { free: 5000,  hon: 6000 },

  // è¿½åŠ åˆ†
  "90":   { free: 7500,  hon: 9000 },
  "120":  { free: 10000, hon: 12000 },
  "150":  { free: 12500, hon: 15000 },
};

function courseBack(course, nom){
  if(!course) return 0;
  const row = COURSE_BACK[course];
  return row ? (row[nom] ?? 0) : 0;
}

function extBack(ext, nom){
  // ãƒãƒƒãƒˆæŒ‡åã¯ãƒ•ãƒªãƒ¼æ‰±ã„
  const nom2 = (nom === "hon") ? "hon" : "free";
  const row = EXT_BACK[ext] || EXT_BACK["none"];
  return row[nom2] ?? 0;
}

// ===== é‡‘é¡ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ =====
const priceSelect = document.getElementById("price");
[0, 5000, 10000].forEach(p=>{
  const o = document.createElement("option");
  o.value = p;
  o.textContent = (p === 0 ? "ã‚«ãƒ¼ãƒ‰æ±ºæ¸ˆï¼ˆ0å††ï¼‰" : p);
  priceSelect.appendChild(o);
});
for(let p = 12000; p <= 30000; p += 1000){
  const o = document.createElement("option");
  o.value = p;
  o.textContent = p;
  priceSelect.appendChild(o);
}

// ===== çŠ¶æ…‹ =====
let selectedCourse = "";
let selectedNom = "free";
let selectedExt = "none";

// UI helpers
function setNom(n){
  selectedNom = n;
  document.querySelectorAll(".nom-btn").forEach(b=>{
    b.classList.toggle("active", b.dataset.nom === n);
  });
  calculate();
}
function setExt(e){
  selectedExt = e;
  document.querySelectorAll(".ext-btn").forEach(b=>{
    b.classList.toggle("active", b.dataset.ext === e);
  });
  calculate();
}

// ã‚³ãƒ¼ã‚¹ï¼ˆå˜ä¸€ï¼‰
document.querySelectorAll(".course-btn").forEach(btn=>{
  btn.addEventListener("click", function(){
    selectedCourse = this.dataset.course;
    document.querySelectorAll(".course-btn").forEach(b=>b.classList.remove("active"));
    this.classList.add("active");
    calculate();
  });
});

// æŒ‡åï¼ˆå˜ä¸€ï¼‰
document.querySelectorAll(".nom-btn").forEach(btn=>{
  btn.addEventListener("click", function(){
    setNom(this.dataset.nom);
  });
});

// å»¶é•·ï¼ˆå˜ä¸€ï¼‰
document.querySelectorAll(".ext-btn").forEach(btn=>{
  btn.addEventListener("click", function(){
    setExt(this.dataset.ext);
  });
});

// åˆæœŸé¸æŠ
setNom("free");
setExt("none");

// é‡‘é¡å¤‰æ›´
priceSelect.addEventListener("change", calculate);

// è¨ˆç®—
function calculate(){
  const price = Number(priceSelect.value || 0);
  const back = courseBack(selectedCourse, selectedNom) + extBack(selectedExt, selectedNom);
  const shop = price - back;

  document.getElementById("back").textContent = `Â¥ ${back.toLocaleString()}`;
  document.getElementById("shop").textContent = `Â¥ ${shop.toLocaleString()}`;
}

// ===== localStorage =====
const STORAGE_KEY = "iyashimayu_course_nom_ext_today_v2";

function load(){
  const raw = localStorage.getItem(STORAGE_KEY);
  return raw ? JSON.parse(raw) : [];
}
function save(r){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(r));
}

// ãƒ©ãƒ™ãƒ«
function nomLabel(n){ return n==="net" ? "ãƒãƒƒãƒˆæŒ‡å" : n==="hon" ? "æœ¬æŒ‡å" : "ãƒ•ãƒªãƒ¼"; }
function extLabel(e){ return e==="30" ? "+30" : e==="60" ? "+60" : "å»¶é•·ãªã—"; }

document.getElementById("addBtn").addEventListener("click", ()=>{
  if(!selectedCourse){
    alert("ã‚³ãƒ¼ã‚¹ã‚’é¸æŠã—ã¦ãã ã•ã„");
    return;
  }
  const price = Number(priceSelect.value || 0);
  const back = courseBack(selectedCourse, selectedNom) + extBack(selectedExt, selectedNom);
  const shop = price - back;

  const rec = {
    course: selectedCourse,
    nom: selectedNom,
    ext: selectedExt,
    price,
    back,
    shop
  };

  const data = load();
  data.push(rec);
  save(data);
  render();
});

function render(){
  const list = document.getElementById("listArea");
  const total = document.getElementById("totalArea");
  const data = load();

  if(data.length === 0){
    list.innerHTML = "<div style='text-align:center;color:#666;'>å±¥æ­´ãªã—</div>";
  }else{
    let html = `<div class="row head">
      <div>å†…å®¹</div><div>é‡‘é¡</div><div>ãƒãƒƒã‚¯</div><div>åº—è½ã¡</div><div></div>
    </div>`;
    data.forEach((r,i)=>{
      const content = `${r.course}åˆ† / ${nomLabel(r.nom)} / ${extLabel(r.ext)}`;
      html += `<div class="row">
        <div>${content}</div>
        <div>${r.price}</div>
        <div class="cell back">${r.back}</div>
        <div>${r.shop}</div>
        <button onclick="del(${i})">ğŸ—‘</button>
      </div>`;
    });
    list.innerHTML = html;
  }

  const count = data.length;
  const sumBack = data.reduce((s,r)=>s+r.back,0);
  const sumShop = data.reduce((s,r)=>s+r.shop,0);

  total.innerHTML = `
    æœ¬æ•°ï¼š${count} æœ¬<br>
    ãƒãƒƒã‚¯åˆè¨ˆï¼šÂ¥ ${sumBack.toLocaleString()}<br>
    åº—è½ã¡åˆè¨ˆï¼šÂ¥ ${sumShop.toLocaleString()}
  `;
}

function del(i){
  const d = load();
  d.splice(i,1);
  save(d);
  render();
}

render();
calculate();
</script>

</body>
</html>
